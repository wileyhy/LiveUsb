#!/bin/bash -eux

declare -n nL=LINENO
fn_bndry=' ~~~ ~~~ ~~~ '
fn_lvl=0
scr_nm='LiveUsb1.sh'

:;: 'Define er_x()'
function er_x(){ local - hyphn="$-" exit_code="$?" _="${fn_bndry} ${FUNCNAME[0]}() BEGINS ${fn_bndry} ${fn_lvl} to $(( ++fn_lvl ))"
  #set -

  ## Some positional parameters must exist
  [[ $# -lt 1 ]] && return 1

  ## The first positional parameter must be a digit, and should be the LINENO from where er_x() is called
  if ! [[ $1 = [0-9]* ]]
  then 
    printf '\n%s, %s, Error, first positional parameter must be a line number\n\n' "${scr_nm}" "${FUNCNAME[0]}"
    return 2
  fi

  local fn_lineno
  fn_lineno="$1"
  shift

  printf '%s, Error, line %d, %s\n' "${scr_nm}" "${fn_lineno}" "$*" >&2

  builtin exit "${exit_code}"

  true "${fn_bndry} ${FUNCNAME[0]}() ENDS ${fn_bndry} ${fn_lvl} to $(( --fn_lvl ))"
}

[[ x = y ]] || er_x $LINENO a b c -- f\unction

